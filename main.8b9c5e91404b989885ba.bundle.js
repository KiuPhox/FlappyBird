(()=>{"use strict";var t,e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};e.d({},{l:()=>T});class s{static init(){s.startTime=window.performance.now(),s.lastFrameTime=0}static get time(){return(window.performance.now()-s.startTime)/1e3}static get deltaTime(){return(window.performance.now()-s.lastFrameTime)/1e3}}class i{constructor(t,e){this._x=t,this._y=e}add(t){return new i(this._x+t._x,this._y+t._y)}sub(t){return new i(this._x-t._x,this._y-t._y)}mul(t){return new i(this._x*t,this._y*t)}static get zero(){return new i(0,0)}static get up(){return new i(0,1)}get x(){return this._x}get y(){return this._y}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}}class n{constructor(t){this._gameObject=t}get gameObject(){return this._gameObject}get name(){return this._name}update(){}}!function(t){t[t.Force=0]="Force",t[t.VelocityChange=1]="VelocityChange"}(t||(t={}));class r extends n{constructor(t,e){super(t),this._name="RigidBody",this._gravityScale=e,this._velocity=i.zero,this.isStatic=!1}set velocity(t){this._velocity=t}get velocity(){return this._velocity}get gravityScale(){return this._gravityScale}set gravityScale(t){this._gravityScale=t}addForce(e,s=t.Force){s==t.Force?this._velocity=this._velocity.sub(e):s==t.VelocityChange&&(this._velocity=new i(e.x,-e.y))}update(){this._gravityScale&&(this._velocity=this._velocity.add(new i(0,100*this._gravityScale).mul(s.deltaTime))),this.velocity.magnitude>.5&&(this._gameObject.transform.position=this._gameObject.transform.position.add(this._velocity.mul(100*s.deltaTime)))}}class a{static init(){a._buttons=[]}static add(t){this._buttons.push(t)}static get buttons(){return a._buttons}}class o{static init(){this.canvas=document.getElementById("game"),this.canvas.width=o.size.x,this.canvas.height=o.size.y,this.canvas.addEventListener("click",o.handleClick),o.context=this.canvas.getContext("2d")}static draw(){if(o.context)for(const t of this.sprites){const e=t.gameObject;if(!e.active)continue;const s=this.size.x/2,i=this.size.y/2,n=t.width/2*e.transform.scale,r=t.height/2*e.transform.scale,a=e.transform.position.x+s,h=e.transform.position.y+i;o.context.save(),o.context.translate(a,h),o.context.rotate(e.transform.rotation),t.flipX&&o.context.scale(-1,1),t.flipY&&o.context.scale(1,-1),t.image.complete&&0!==t.image.naturalWidth&&o.context.drawImage(t.image,-n,-r,t.width*e.transform.scale,t.height*e.transform.scale),o.context.restore()}}static registerSprite(t){o.sprites.push(t),o.sprites.sort(((t,e)=>e.order-t.order))}static handleClick(t){const e=new i(t.offsetX-o.size.x/2,t.offsetY-o.size.y/2);for(const t of a.buttons){if(!t.active)return;const s=t.transform.position;e.x>=s.x-t.width/2&&e.x<=s.x+t.width/2&&e.y>=s.y-t.height/2&&e.y<=s.y+t.height/2&&t.onClick()}}}o.size=new i(288,500),o.sprites=[];class h extends n{constructor(t,e){super(t),this._image=new Image,this._order=e,this._name="Sprite",this.flipX=!1,this.flipY=!1,o.registerSprite(this)}setSprite(t){this._image.src=t}get order(){return this._order}get width(){return this._image.width}get height(){return this._image.height}get image(){return this._image}}class c{constructor(t){this.parent=null,this.children=[],this.name=t,T.registerNode(this),this.isActive=!0}start(){}update(){}onEnabled(){}onDisabled(){}executeStart(){this.start();for(let t=0;t<this.children.length;t++)this.children[t].executeStart()}executeUpdate(){if(this.active){this.update();for(let t=0;t<this.children.length;t++)this.children[t].executeUpdate()}}setChild(t){this.children.includes(t)||(this.children.push(t),t.parent=this)}setParent(t){t.setChild(this)}get active(){return this.isActive}setActive(t){this.isActive=t,this.active?this.onEnabled:this.onDisabled}}class p extends c{constructor(){super("GameObject"),this.transform={position:new i(0,0),rotation:0,scale:1},this.layer="Default",this.components={}}update(){super.update();for(const t in this.components)this.active&&this.components[t].update()}addComponent(t){this.components[t.name]=t,"Collider"===t.name&&(t.OnCollisionStay.subscribe(this.OnCollisionStay),t.OnTriggerStay.subscribe(this.OnTriggerStay))}getComponent(t){return this.components[t]}OnTriggerStay(t){}OnCollisionStay(t){}}class d extends p{constructor(){super(),this.sprite=new h(this,3),this.sprite.setSprite("assets/images/background-day.png"),this.addComponent(new r(this,0)),this.addComponent(this.sprite)}}class g{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)}invoke(t){for(const e of this.listeners)e(t)}}class l{constructor(){this.OnGameStateChanged=new g}static Instance(){return l.instance||(l.instance=new l),l.instance}updateGameState(t){this.gameState=t,this.gameState,this.OnGameStateChanged.invoke(this.gameState)}getGameState(){return this.gameState}}class m{static init(){m.add("Default")}static add(t){u.registerInteractiveLayer(t),this._layers.push(t)}static remove(t){this._layers.splice(this._layers.indexOf(t))}static get layers(){return this._layers}}m._layers=[];class u{static get bounciness(){return.75}static registerCollider(t){u.colliders.push(t)}static registerInteractiveLayer(t){for(const e of m.layers)u.interactiveLayers[e+","+t]=!0,u.interactiveLayers[t+","+e]=!0;u.interactiveLayers[t+","+t]=!0}static setInteractiveLayer(t,e,s){u.interactiveLayers[t+","+e]=s,u.interactiveLayers[e+","+t]=s}static checkInteractiveLayer(t,e){return u.interactiveLayers[t+","+e]}static update(){for(let t=0;t<u.colliders.length-1;t++)for(let e=t+1;e<u.colliders.length;e++)this.checkInteractiveLayer(u.colliders[t].gameObject.layer,u.colliders[e].gameObject.layer)&&this.checkCollider(u.colliders[t],u.colliders[e])&&(u.colliders[t].callbackEvent(u.colliders[e]),u.colliders[e].callbackEvent(u.colliders[t]))}static checkCollider(t,e){const s=t.gameObject.transform.position,i=e.gameObject.transform.position;return s.x+t.size.x/2>i.x-e.size.x/2&&s.x-t.size.x/2<i.x+e.size.x/2&&s.y+t.size.y/2>i.y-e.size.y/2&&s.y-t.size.y/2<i.y+e.size.y/2}}u.colliders=[],u.interactiveLayers={};class y extends n{constructor(t){super(t),this.OnCollisionStay=new g,this.OnTriggerStay=new g,this.isTrigger=!1,this._name="Collider",u.registerCollider(this)}get size(){const t=this.gameObject.getComponent("Sprite");return new i(t.width,t.height)}update(){super.update()}isTouch(t){const e=this.gameObject.transform.position,s=t.gameObject.transform.position;return e.x+this.size.x/2>s.x-t.size.x/2&&e.x-this.size.x/2<s.x+t.size.x/2&&e.y+this.size.y/2>s.y-t.size.y/2&&e.y-this.size.y/2<s.y+t.size.y/2}callbackEvent(t){if(this.isTrigger)this.OnTriggerStay.invoke(t);else{if(!this.gameObject.getComponent("RigidBody"))return;const e=this.gameObject.getComponent("RigidBody");if(e.isStatic)return;const s=(t.gameObject.getComponent("RigidBody")?t.gameObject.getComponent("RigidBody").velocity:i.zero).sub(e.velocity.mul(u.bounciness));e.velocity=s.magnitude<.005?i.zero:s,this.OnCollisionStay.invoke(t)}}}class w{static init(){document.addEventListener("keydown",(t=>this.handleKeyDown(t))),document.addEventListener("keyup",(t=>this.handleKeyUp(t))),document.addEventListener("mousedown",(()=>this.handleMouseDown())),document.addEventListener("mouseup",(()=>this.handleMouseUp())),document.addEventListener("touchstart",(()=>this.handleMouseDown())),document.addEventListener("touchend",(()=>this.handleMouseUp())),this.isHeld=!1}static getKeyDown(t){return this.previousKeyStates.has(t)}static getMouseDown(){return this.isMouseDown}static handleKeyDown(t){const e=t.code;this.isHeld||this.previousKeyStates.has(e)||(this.isHeld=!0,this.previousKeyStates.add(e))}static handleKeyUp(t){const e=t.code;this.isHeld=!1,this.previousKeyStates.has(e)&&(console.log("delete"),this.previousKeyStates.delete(e))}static handleMouseDown(){this.isMouseDown=!0}static handleMouseUp(){this.isMouseDown=!1}static reset(){this.previousKeyStates.clear(),this.isMouseDown=!1}}w.previousKeyStates=new Set;const S="assets/images/bird-mid.png";class v extends p{constructor(){super(),l.Instance().OnGameStateChanged.subscribe((t=>this.OnGameStateChanged(t))),this.name="Bird",this.jumpForce=4.5,this.rigidBody=new r(this,0),this.sprite=new h(this,1),this.sprite.setSprite(S),this.addComponent(new y(this)),this.addComponent(this.rigidBody),this.addComponent(this.sprite)}update(){super.update(),w.getKeyDown("Space")&&("Idle"===l.Instance().getGameState()?(this.jump(),l.Instance().updateGameState("Start")):"Start"===l.Instance().getGameState()?this.jump():"GameOver"===l.Instance().getGameState()&&l.Instance().updateGameState("Idle")),w.getMouseDown()&&("Idle"===l.Instance().getGameState()?(this.jump(),l.Instance().updateGameState("Start")):"Start"===l.Instance().getGameState()&&this.jump()),this.rotateBaseOnGravity(),this.updateAnimation()}jump(){this.rigidBody.addForce(i.up.mul(this.jumpForce),t.VelocityChange)}rotateBaseOnGravity(){this.transform.rotation=this.rigidBody.velocity.y/5}updateAnimation(){this.rigidBody.velocity.y>.5?this.sprite.setSprite("assets/images/bird-up.png"):this.rigidBody.velocity.y<.5&&this.rigidBody.velocity.y>-1?this.sprite.setSprite(S):this.rigidBody.velocity.y<-1&&this.sprite.setSprite("assets/images/bird-down.png")}OnGameStateChanged(t){switch(t){case"Idle":this.transform.position=i.zero,this.rigidBody.velocity=i.zero,this.rigidBody.gravityScale=0;break;case"Start":this.rigidBody.gravityScale=.15}}OnCollisionStay(t){"Start"!=l.Instance().getGameState()||"Ground"!=t.gameObject.name&&"Pipe"!=t.gameObject.name||l.Instance().updateGameState("GameOver")}}class f extends p{constructor(){super(),this.sprite=new h(this,0),this.sprite.setSprite("assets/images/gameover.png"),this.addComponent(this.sprite)}}class x extends p{constructor(){super(),this.name="Ground",this.layer="Background";const t=new h(this,1);t.setSprite("assets/images/base.png"),this.addComponent(t),this.addComponent(new y(this));const e=new r(this,0);e.isStatic=!0,this.addComponent(e)}}class b extends p{constructor(){super(),this.transform.position=new i(0,60),this.sprite=new h(this,0),this.sprite.setSprite("assets/images/message.png"),this.addComponent(this.sprite)}}class C extends p{constructor(){super(),this.layer="Background",this.name="Pipe",this.transform.position=i.zero,this.sprite=new h(this,2),this.sprite.setSprite("assets/images/pipe-green.png"),this.addComponent(this.sprite),this.addComponent(new y(this));const t=new r(this,0);t.isStatic=!0,this.addComponent(t),this.isCount=!0}get center(){return new i(this.transform.position.x+this.sprite.width/2,this.transform.position.y+this.sprite.height/2)}setIsCount(t){this.isCount=t}getIsCount(){return this.isCount}}class _{static Random(t,e){return Math.floor(Math.random()*(e-t+1)+t)}}class O{constructor(t){this._score=t,this.highScore=0,this.digits=Array.from({length:4},(()=>new p)),this.sprites=[];for(let t=0;t<this.digits.length;t++)this.sprites[t]=new h(this.digits[t],0),this.digits[t].addComponent(this.sprites[t]),this.sprites[t].setSprite("/assets/images/0.png");this.digits[0].transform.position=new i(-10,-200),this.digits[1].transform.position=new i(this.digits[0].transform.position.x+25,this.digits[0].transform.position.y),this.digits[2].transform.position=new i(-5,-160),this.digits[3].transform.position=new i(this.digits[2].transform.position.x+15,this.digits[2].transform.position.y),this.digits[2].transform.scale=.6,this.digits[3].transform.scale=.6}reset(){this._score=0,this.numberToDigits()}static Instance(){return O.instance||(O.instance=new O(0)),O.instance}increaseScore(){this._score++,this._score>this.highScore&&(this.highScore=this._score),this.display()}display(){this.numberToDigits()}numberToDigits(){this.sprites[1].setSprite(`/assets/images/${this._score%10}.png`),this.sprites[0].setSprite(`/assets/images/${Math.floor(this._score/10)}.png`),this.sprites[3].setSprite(`/assets/images/${this.highScore%10}.png`),this.sprites[2].setSprite(`/assets/images/${Math.floor(this.highScore/10)}.png`)}}class I{constructor(t,e){this.pool=[],this.createObject=t,this.resetObject=e}get(){return this.pool.length>0?this.pool.pop():this.createObject()}release(t){this.resetObject(t),this.pool.push(t)}clear(){this.pool.length=0}}const z=new i(-1.7,0);class B extends c{constructor(){super("Pipe Spawner"),this.spawnPos=new i(o.size.x/2+50,0),this.spawnBetweenTime=1,this.spawnTimer=this.spawnBetweenTime,this.pipes=[],this.pipePool=new I((()=>{const t=new C;return t.parent=this,t.getComponent("RigidBody").velocity=z,this.pipes.push(t),t}),(t=>{t.transform.position=new i(this.spawnPos.x,this.spawnPos.y),t.setActive(!1)}))}update(){this.spawnTimer-=s.deltaTime,this.spawnTimer<0&&(this.spawnTimer=this.spawnBetweenTime,this.spawn());for(let t=0;t<this.pipes.length;t++)!this.pipes[t].getIsCount()&&this.pipes[t].transform.position.x<0&&(this.pipes[t].setIsCount(!0),O.Instance().increaseScore()),this.pipes[t].active&&this.pipes[t].transform.position.x+50<-o.size.x&&this.pipePool.release(this.pipes[t])}clear(){for(let t=0;t<this.pipes.length;t++)this.pipePool.release(this.pipes[t])}setIsSpawn(t){this.setActive(t);for(const e of this.pipes)e.getComponent("RigidBody").velocity=t?z:i.zero}spawn(){const t=this.pipePool.get();t.setActive(!0),t.setIsCount(!0),t.getComponent("Sprite").flipY=!1,t.transform.position=new i(this.spawnPos.x,_.Random(60,220));const e=this.pipePool.get();e.transform.position=new i(this.spawnPos.x,t.transform.position.y-430),e.setActive(!0),e.setIsCount(!1),e.getComponent("Sprite").flipY=!0}}class j extends p{constructor(t){super(),this.sprite=new h(this,0),this.sprite.setSprite(t),this.addComponent(this.sprite),a.add(this)}get width(){return this.sprite.width*this.transform.scale}get height(){return this.sprite.height*this.transform.scale}}class G extends j{constructor(){super("assets/images/start.png"),this.transform.position=new i(0,50),this.transform.scale=.35}onClick(){l.Instance().updateGameState("Idle")}}class T{constructor(){w.init(),s.init(),a.init(),o.init(),m.init(),m.add("Background"),u.setInteractiveLayer("Background","Background",!1),this.gameManager=l.Instance(),this.gameManager.OnGameStateChanged.subscribe((t=>this.OnGameStateChanged(t))),new v,T.bg=Array.from({length:2},(()=>new d)),T.bgSprite=T.bg[0].getComponent("Sprite"),this.pipeSpawner=new B,T.ground=Array.from({length:2},(()=>new x)),T.groundSprite=T.ground[0].getComponent("Sprite"),T.ground[0].transform.position=new i(0,200),this.message=new b,this.playAgainButton=new G,this.gameOver=new f,this.gameManager.updateGameState("Idle"),this.loop()}loop(){s.deltaTime>=1/300&&(u.update(),T.update(),o.draw(),w.reset(),s.lastFrameTime=window.performance.now()),window.requestAnimationFrame((()=>{this.loop()}))}static registerNode(t){T.nodes.push(t)}static update(){for(let t=0;t<this.nodes.length;t++)this.nodes[t].executeUpdate();"Start"!=this.gameState&&"Idle"!=this.gameState||(this.bg[1].transform.position=new i(this.bg[0].transform.position.x+this.bgSprite.width,0),this.bg[0].transform.position.x+this.bgSprite.width<=0&&(this.bg[0].transform.position=i.zero),this.ground[1].transform.position=new i(this.ground[0].transform.position.x+this.groundSprite.width,this.ground[0].transform.position.y),this.ground[0].transform.position.x+this.groundSprite.width<=0&&(this.ground[0].transform.position=new i(0,200)))}OnGameStateChanged(t){if(T.gameState!==t)switch(T.gameState=t,T.gameState){case"Idle":this.gameOver.setActive(!1),this.playAgainButton.setActive(!1),this.message.setActive(!0),T.bg[0].getComponent("RigidBody").velocity=new i(-.5,0),T.ground[0].getComponent("RigidBody").velocity=new i(-1.7,0),this.pipeSpawner.clear(),this.pipeSpawner.setActive(!1),O.Instance().reset();break;case"Start":this.pipeSpawner.setIsSpawn(!0),this.message.setActive(!1);break;case"GameOver":T.bg[0].getComponent("RigidBody").velocity=i.zero,T.ground[0].getComponent("RigidBody").velocity=i.zero,this.pipeSpawner.setIsSpawn(!1),this.gameOver.setActive(!0),this.playAgainButton.setActive(!0)}}}T.nodes=[],new T})();